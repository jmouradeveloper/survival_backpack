---
title: Regras de Desenvolvimento com Docker
description: Regras obrigatÃ³rias para execuÃ§Ã£o de comandos via Docker
tags: [docker, development, testing, rails]
priority: critical
---

# Regras de Desenvolvimento com Docker

Este projeto utiliza **Docker para desenvolvimento** e **NUNCA deve executar comandos diretamente no sistema local**.

## âš ï¸ REGRA CRÃTICA

**SEMPRE** utilize os scripts Docker disponÃ­veis no diretÃ³rio `bin/` para executar comandos Rails.
**NUNCA** execute comandos Rails, bundle, npm ou qualquer comando de desenvolvimento diretamente no sistema host.

---

## ğŸ§ª Testes

### âŒ NUNCA faÃ§a isto:
```bash
rails test
bin/rails test
bundle exec rails test
rake test
```

### âœ… SEMPRE faÃ§a isto:
```bash
bin/docker-test                                    # Todos os testes
bin/docker-test --models                           # Apenas models
bin/docker-test --controllers                      # Apenas controllers
bin/docker-test --integration                      # Testes de integraÃ§Ã£o
bin/docker-test --system                           # Testes de sistema
bin/docker-test --file test/models/food_item_test.rb  # Teste especÃ­fico
bin/docker-test --coverage                         # Com cobertura
bin/docker-test --verbose                          # Modo verbose
```

### Exemplos de uso:
- Testar um model especÃ­fico: `bin/docker-test --file test/models/food_item_test.rb`
- Testar todos os controllers: `bin/docker-test --controllers`
- Ver cobertura de cÃ³digo: `bin/docker-test --coverage`

### ğŸ”„ SincronizaÃ§Ã£o AutomÃ¡tica:
O script `bin/docker-test` **sincroniza automaticamente** o banco de dados de testes antes de executar os testes. VocÃª nÃ£o precisa fazer nada manualmente!

---

## ğŸ’» Console Rails

### âŒ NUNCA faÃ§a isto:
```bash
rails console
bin/rails console
rails c
```

### âœ… SEMPRE faÃ§a isto:
```bash
bin/docker-console
```

---

## ğŸ—„ï¸ Migrations e Database

### âŒ NUNCA faÃ§a isto:
```bash
rails db:migrate
rails db:seed
rails db:rollback
rails db:reset
```

### âœ… SEMPRE faÃ§a isto:
```bash
docker compose exec web bin/rails db:migrate
docker compose exec web bin/rails db:seed
docker compose exec web bin/rails db:rollback
docker compose exec web bin/rails db:reset
docker compose exec web bin/rails db:create
docker compose exec web bin/rails db:drop
```

---

## ğŸ› ï¸ Generators Rails

### âŒ NUNCA faÃ§a isto:
```bash
rails generate model User
rails generate controller Users
rails generate migration AddFieldToTable
```

### âœ… SEMPRE faÃ§a isto:
```bash
docker compose exec web bin/rails generate model User
docker compose exec web bin/rails generate controller Users
docker compose exec web bin/rails generate migration AddFieldToTable
```

---

## ğŸ“¦ Bundle e DependÃªncias

### âŒ NUNCA faÃ§a isto:
```bash
bundle install
bundle update
gem install [gem_name]
```

### âœ… SEMPRE faÃ§a isto:
```bash
# Instalar gems
docker compose exec web bundle install

# ApÃ³s adicionar gems no Gemfile, reconstruir a imagem
docker compose build web

# Ou usar o script de setup que faz tudo
bin/docker-setup
```

---

## ğŸ” Linters e AnÃ¡lise de CÃ³digo

### âŒ NUNCA faÃ§a isto:
```bash
rubocop
brakeman
bundle exec rubocop
```

### âœ… SEMPRE faÃ§a isto:
```bash
docker compose exec web bin/rubocop
docker compose exec web bin/brakeman
```

---

## ğŸš€ Scripts Docker DisponÃ­veis

Os seguintes scripts estÃ£o disponÃ­veis no diretÃ³rio `bin/`:

| Script | DescriÃ§Ã£o |
|--------|-----------|
| `bin/docker-up` | Iniciar containers do projeto |
| `bin/docker-stop` | Parar containers |
| `bin/docker-test` | Executar testes automatizados |
| `bin/docker-console` | Acessar console Rails |
| `bin/docker-logs` | Ver logs dos containers |
| `bin/docker-setup` | Setup inicial do projeto (primeira vez) |
| `bin/docker-clean` | Limpar containers, volumes e imagens |
| `bin/docker-clean-cache` | Limpar apenas cache |

---

## ğŸ”„ Workflow Comum

### Iniciar o ambiente (primeira vez):
```bash
bin/docker-setup  # Configura tudo automaticamente, incluindo banco de testes
```

### Iniciar o ambiente (dia a dia):
```bash
bin/docker-up
```

### Executar testes:
```bash
bin/docker-test  # Sincroniza o banco de testes automaticamente antes de executar
```

### Acessar console:
```bash
bin/docker-console
```

### Ver logs:
```bash
bin/docker-logs
```

### Parar ambiente:
```bash
bin/docker-stop
```

### Limpar tudo:
```bash
bin/docker-clean
```

---

## ğŸ“ Quando Sugerir Comandos ao UsuÃ¡rio

Quando o usuÃ¡rio pedir:

- **"Executar testes"** â†’ Sugira: `bin/docker-test`
- **"Testar o modelo X"** â†’ Sugira: `bin/docker-test --file test/models/x_test.rb`
- **"Testar controllers"** â†’ Sugira: `bin/docker-test --controllers`
- **"Abrir console"** â†’ Sugira: `bin/docker-console`
- **"Rodar migrations"** â†’ Sugira: `docker compose exec web bin/rails db:migrate`
- **"Criar migration"** â†’ Sugira: `docker compose exec web bin/rails generate migration NomeMigration`
- **"Instalar gems"** â†’ Sugira: `docker compose exec web bundle install && docker compose build web`
- **"Ver logs"** â†’ Sugira: `bin/docker-logs`
- **"Resetar banco"** â†’ Sugira: `docker compose exec web bin/rails db:reset`

---

## ğŸ¯ BenefÃ­cios desta Abordagem

1. **ConsistÃªncia**: Todos os desenvolvedores usam o mesmo ambiente
2. **Isolamento**: NÃ£o polui o sistema local com dependÃªncias
3. **Reproduzibilidade**: "Funciona na minha mÃ¡quina" deixa de ser problema
4. **FÃ¡cil onboarding**: Novos devs apenas executam `bin/docker-setup`
5. **CI/CD**: Mesmo ambiente em desenvolvimento e produÃ§Ã£o

---

## ğŸ“š DocumentaÃ§Ã£o Adicional

Para mais detalhes, consulte:
- `docs/DOCKER_DEVELOPMENT.md` - Guia completo de desenvolvimento com Docker
- `docs/DOCKER_SCRIPTS_REFERENCE.md` - ReferÃªncia detalhada de todos os scripts
- `QUICKSTART.md` - Guia rÃ¡pido para comeÃ§ar

---

## âš¡ Comandos de EmergÃªncia

Se algo der errado:

```bash
# Parar tudo
bin/docker-stop

# Limpar tudo e comeÃ§ar do zero
bin/docker-clean

# Reconfigurar o ambiente
bin/docker-setup

# Verificar status dos containers
docker compose ps

# Ver logs em tempo real
docker compose logs -f web
```

---

## ğŸš¨ IMPORTANTE

- **NUNCA execute comandos Ruby/Rails/Bundle diretamente no host**
- **SEMPRE use Docker** atravÃ©s dos scripts ou `docker compose exec web`
- Se vocÃª esquecer e executar localmente, pode causar inconsistÃªncias
- Em caso de dÃºvida, consulte `docs/DOCKER_SCRIPTS_REFERENCE.md`
