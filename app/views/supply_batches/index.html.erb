<div class="container mx-auto px-4 py-8">
  <div class="flex justify-between items-center mb-6">
    <h1 class="text-3xl font-bold text-gray-800">Lotes de Suprimentos (FIFO)</h1>
    <%= link_to new_supply_batch_path, 
                data: { turbo_frame: "modal" },
                class: "bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded transition" do %>
      + Novo Lote
    <% end %>
  </div>

  <!-- Filtros -->
  <div class="bg-white rounded-lg shadow-md p-4 mb-6">
    <%= form_with url: supply_batches_path, method: :get, 
                  data: { controller: "filters", turbo_frame: "supply_batches_list" } do |f| %>
      <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
        <div>
          <%= f.label :food_item_id, "Alimento", class: "block text-sm font-medium text-gray-700 mb-1" %>
          <%= f.select :food_item_id, 
                      options_for_select(
                        [["Todos", ""]] + FoodItem.order(:name).pluck(:name, :id),
                        params[:food_item_id]
                      ),
                      {},
                      class: "w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",
                      data: { action: "change->filters#submit" } %>
        </div>
        
        <div>
          <%= f.label :status, "Status", class: "block text-sm font-medium text-gray-700 mb-1" %>
          <%= f.select :status,
                      options_for_select(
                        [
                          ["Todos", ""],
                          ["Ativos", "active"],
                          ["Esgotados", "depleted"],
                          ["Vencidos", "expired"]
                        ],
                        params[:status]
                      ),
                      {},
                      class: "w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",
                      data: { action: "change->filters#submit" } %>
        </div>
        
        <div>
          <%= f.label :sort, "Ordenação", class: "block text-sm font-medium text-gray-700 mb-1" %>
          <%= f.select :sort,
                      options_for_select(
                        [
                          ["FIFO (Prioridade)", ""],
                          ["Mais Recentes", "recent"]
                        ],
                        params[:sort]
                      ),
                      {},
                      class: "w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",
                      data: { action: "change->filters#submit" } %>
        </div>
        
        <div class="flex items-end">
          <%= link_to "Limpar Filtros", supply_batches_path, 
                      class: "w-full text-center px-3 py-2 bg-gray-200 hover:bg-gray-300 text-gray-700 rounded-md transition",
                      data: { turbo_frame: "supply_batches_list" } %>
        </div>
      </div>
    <% end %>
  </div>

  <!-- Lista de Lotes -->
  <%= turbo_frame_tag "supply_batches_list" do %>
    <div class="grid grid-cols-1 gap-4">
      <% if @supply_batches.any? %>
        <% @supply_batches.each do |batch| %>
          <%= render "supply_batch_card", batch: batch %>
        <% end %>
        
        <!-- Paginação -->
        <div class="mt-6">
          <%== pagy_nav(@pagy) if defined?(@pagy) %>
        </div>
      <% else %>
        <div class="bg-white rounded-lg shadow-md p-8 text-center text-gray-500">
          <p>Nenhum lote encontrado.</p>
          <%= link_to "Criar primeiro lote", new_supply_batch_path, 
                      data: { turbo_frame: "modal" },
                      class: "mt-4 inline-block text-blue-600 hover:text-blue-800" %>
        </div>
      <% end %>
    </div>
  <% end %>
</div>

<!-- Modal para formulários -->
<%= turbo_frame_tag "modal" %>

